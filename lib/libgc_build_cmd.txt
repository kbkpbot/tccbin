#!/usr/bin/env bash

echo "Configuring ..."
CC=gcc CFLAGS='-Os -mtune=generic' LDFLAGS='-Os' ./configure \
	--enable-threads=pthreads \
	--enable-static \
	--enable-shared=no \
	--enable-thread-local-alloc=no \
	--enable-single-obj-compilation \
        --disable-parallel-mark \
	--enable-gc-assertions

echo "Compiling libgc.a ..."
make

echo "Copying libgc.a to its final place in V's thirdparty/tcc/lib/libgc.a ..."
cp .libs/libgc.a /opt/v/thirdparty/tcc/lib/libgc.a

echo "Done"
